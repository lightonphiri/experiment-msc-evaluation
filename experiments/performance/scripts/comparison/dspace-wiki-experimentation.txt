Instance set up
  -> A total of 15 seperate DSpace instances [1] were set up.


Collection Hierarchy
  -> 
  -> ./dspace structure-builder -f /home/phiri/Projects/masters/scripts/w1-structure.xml -o ../upload/w1-structure-out.xml -e lphiri@cs.uct.ac.za
  -> for workload in `seq 2 15`; do /usr/local/workloads/w$workload/bin/dspace structure-builder -f /home/phiri/Projects/masters/scripts/w$workload-structure.xml -o ../upload/w$workload-structure-out.xml -e lphiri@cs.uct.ac.za; done


SELECT h.handle, c.name 
FROM ((SELECT resource_id, handle FROM handle WHERE resource_type_id=3) as h JOIN 
(SELECT collection_id, name FROM collection) as c ON 
h.resource_id = c.collection_id);





for workload in range(1,16):
   dspacebenchmarks.dspacestructure('/home/phiri/Projects/masters/random/workload1/w'+str(workload), 'w'+str(workload), 'union-ndltd-org-ListSets.xml')



1. create database
createdb -U dspace -E UNICODE dspace -h localhost

for workload in `seq 1 15`; do createdb -U dspace -E UNICODE w$workload -h localhost; done

for workload in `seq 1 15`; do dropdb w$workload; done


for workload in `seq 1 15`
do
cp /home/phiri/Projects/masters/dspace/configs/w$workload-dspace.cfg /home/phiri/Projects/masters/dspace/dspace-3.1-release/dspace/target/dspace-3.1-build/config/dspace.cfg
cd /home/phiri/Projects/masters/dspace/dspace-3.1-release/dspace/target/dspace-3.1-build
ant fresh_install
done



2. create administrator
./dspace create-administrator

/usr/local/workloads/w1/bin/dspace create-administrator

3. create structure
sh /usr/local/dspace/bin/dspace structure-builder -f /home/phiri/Projects/masters/dspace/dspace-structure-w3.xml -o /usr/local/dspace/upload/dspace-structure-w3.xml.out -e lphiri@cs.uct.ac.za


for workload in `seq 1 15`
do 
sh /usr/local/workloads/w$workload/bin/dspace structure-builder -f /home/phiri/Projects/masters/dspace/"w"$workload-structure.xml -o /usr/local/workloads/w$workload/upload/"w"$workload-structure.xml.out -e lphiri@cs.uct.ac.za;
done


/usr/local/workloads/w11/bin/dspace structure-builder -f /home/phiri/Projects/masters/dspace/w11-structure.xml -o /usr/local/workloads/w11/upload/w11-structure.xml.out -e lphiri@cs.uct.ac.za


4. generate csv files using Python script

import dspacebenchmarks
dspacebenchmarks.dspacecsvfile('/home/phiri/Projects/masters/random/workload1/w5', 'dspace', 10, 'w5')
dspacebenchmarks.dspacecsvfile('/home/phiri/Projects/masters/random/workload1/w5', 'dspace', 100, 'w5')
dspacebenchmarks.dspacecsvfile('/home/phiri/Projects/masters/random/workload1/w5', 'dspace', 1000, 'w5')


import dspacebenchmarks
for workload in range(1,16):
   dspacebenchmarks.dspacecsvfile('/home/phiri/Projects/masters/random/workload1/w'+str(workload), 'w'+str(workload), 1000, 'w'+str(workload))


5. change configurations for bulk import
./config/modules/bulkedit.cfg


for workload in `seq 1 15`
do 
cp /home/phiri/Projects/masters/dspace/configs/bulkedit.cfg /usr/local/workloads/w$workload/config/modules/bulkedit.cfg
done


6. metadata-import utility

sh ../bin/dspace metadata-import -f dspace-bme-CHENGCHI.csv -e lphiri@cs.uct.ac.za -s


metadata-import -f $file -e lphiri@cs.uct.ac.za -s

for file in `ls /home/phiri/Projects/masters/dspace/ingestion/10/dspace-10* | grep dspace-10`; do sh /usr/local/dspace/bin/dspace metadata-import -f $file -e lphiri@cs.uct.ac.za -s; done


nohup sh -c 'for file in `ls /home/phiri/Projects/masters/dspace/ingestion/10/dspace-10* | grep dspace-10`; do sh /usr/local/dspace/bin/dspace metadata-import -f $file -e lphiri@cs.uct.ac.za -s; done' &

nohup sh -c 'for file in `ls /home/phiri/Projects/masters/dspace/ingestion/100/dspace-100* | grep dspace-100`; do sh /usr/local/dspace/bin/dspace metadata-import -f $file -e lphiri@cs.uct.ac.za -s; done' &


 #### Profiling #### 
nohup sh -c 'for file in `ls /home/phiri/Projects/masters/dspace/ingestion/1000/dspace-1000-* | grep dspace-1000-`; do echo "START: "$file; sh /usr/local/dspace/bin/dspace metadata-import -f $file -e lphiri@cs.uct.ac.za -s; echo "END: "$file; done' &



for workload in `seq 1 2`
do
echo "START: "$workload
for file in /home/phiri/Projects/masters/dspace/ingestion/workloads/w$workload/*-1000-*.csv 
do 
echo "START: "$file
#sh /usr/local/workloads/w$workload/bin/dspace metadata-import -f $file -e lphiri@cs.uct.ac.za -s
echo /usr/local/workloads/w$workload/bin/dspace metadata-import -f $file -e lphiri@cs.uct.ac.za -s
echo "END: "$file;
done
echo "END: "$workload
sleep 5
done



/usr/local/dspace/bin/dspace metadata-import -f /home/phiri/Projects/masters/dspace/dspace-1000-1.csv -e lphiri@cs.uct.ac.za -s




python -c "import dspacebenchmarks; dspacebenchmarks.dspacecsvfile('/home/phiri/Projects/masters/random/workload1/w8', 'w8', 10000)";


Log Analysis


cat dspace.log.2013-01-31 | grep item | awk '{sub(/,item_id/,"item_id"); print}' | awk '{sub(/,/,":"); print}' | awk '{print $1","$2","$3","$4","$5","$6}' > dspace-ingestion-log.csv



for workload in `seq 1 10`
do
echo "w$workload|"`cat /usr/local/workloads/w$workload/log/dspace.log.2013-02-02 | grep "Wrote Item" | head -n 1 | awk '{sub(/,/,"."); print}' | awk '{print $1"|"$2"|"$3""$4""$5""$6""$7""$8""$9""$10""$11}'`
echo "w$workload|"`cat /usr/local/workloads/w$workload/log/dspace.log.2013-02-02 | grep "Wrote Item" | tail -1 | awk '{sub(/,/,"."); print}' | awk '{print $1"|"$2"|"$3""$4""$5""$6""$7""$8""$9""$10""$11}'`
done




[1] https://wiki.duraspace.org/display/DSPACE/MultipleDspaceOneServer

